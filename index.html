<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Volumenstrom Rechner</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }

      h1,
      h2 {
        text-align: center;
      }

      div.fields {
        display: grid;
        grid-template-columns: 1fr fit-content(20%) 1fr;
        /* grid-template-columns: max-content 2fr max-content; */
        align-items: center;
        grid-gap: 5px;
      }
      div.fields label {
        text-align: right;
      }
      div.fields label:after {
        content: ":";
      }
      div.fields unit {
        text-align: left;
      }

      label {
        display: block;
        margin-bottom: 5px;
      }
    </style>
  </head>
  <body>
    <h1>Volumenstrom Rechner</h1>

    <h2>Volumenstrom</h2>

    <div class="fields">
      <label>Volumenstrom</label>
      <input
        type="number"
        id="flowM3H"
        placeholder="Enter air flow (m³/h)"
        oninput="changedInput(event)"
      />
      <unit>m³/h</unit>

      <label>Volumenstrom</label>
      <input
        type="number"
        id="flowM3S"
        placeholder="Enter air flow (m³/s)"
        oninput="changedInput(event)"
      />
      <unit>m³/s</unit>
    </div>

    <h2>Querschnittsfläche</h2>

    <div class="fields">
      <label>Druchmesser</label>
      <input
        type="number"
        id="areaDiameterMM"
        placeholder="Enter diameter (mm)"
        oninput="changedInput(event)"
      />
      <unit>mm</unit>

      <label>Querschnittsfläche</label>
      <input
        type="number"
        id="areaM2"
        placeholder="Enter area section (m²)"
        oninput="changedInput(event)"
      />
      <unit>m²</unit>
    </div>

    <h2>Geschwindigkeit</h2>

    <div class="fields">
      <label>Geschwindigkeit</label>
      <input
        type="number"
        id="speedMS"
        placeholder="Enter air speed (m/s)"
        oninput="changedInput(event)"
      />
      <unit>m/s</unit>
    </div>

    <script>
      function changedInput(event) {
        console.log("changedInput");
        console.log(event.currentTarget.id);
        convertUnits(event.currentTarget.id);
        updateInputOrder(event.currentTarget.id);
        calculateVolumeFlow();
      }

      function convertUnits(idEntered) {
        // Convert air flow to m³/s if entered in m³/h
        if ("flowM3H" == idEntered) {
          // Get input value
          var flowM3H = parseFloat(document.getElementById("flowM3H").value);
          if (!isNaN(flowM3H)) {
            document.getElementById("flowM3S").value = (flowM3H / 3600).toFixed(
              4
            ); // 1 m³/s = 3600 m³/h
          }
        }

        // Convert air flow to m³/h if entered in m³/s
        if ("flowM3S" == idEntered) {
          // Get input value
          var flowM3S = parseFloat(document.getElementById("flowM3S").value);
          if (!isNaN(flowM3S)) {
            document.getElementById("flowM3H").value = flowM3S * 3600;
          }
        }

        // Cross section in m²
        if ("areaM2" == idEntered) {
          // Get input value
          var areaM2 = parseFloat(document.getElementById("areaM2").value);
          if (!isNaN(areaM2)) {
            document.getElementById("areaDiameterMM").value =
              (areaM2 / Math.PI) ** 0.5 * 2 * 1000;
          }
        }

        // Diameter in mm
        if ("areaDiameterMM" == idEntered) {
          // Get input value
          var areaDiameterMM = parseFloat(
            document.getElementById("areaDiameterMM").value
          );
          if (!isNaN(areaDiameterMM)) {
            document.getElementById("areaM2").value =
              (areaDiameterMM / 1000 / 2) ** 2 * Math.PI;
          }
        }
      }

      function calculateVolumeFlow() {
        if (inputOrder.length >= 2) {
          iO2 = inputOrder.slice(0, 2);
          console.log(iO2);
          if (iO2.includes("area") && iO2.includes("flow")) {
            var areaM2 = parseFloat(document.getElementById("areaM2").value);
            var flowM3S = parseFloat(document.getElementById("flowM3S").value);
            document.getElementById("speedMS").value = flowM3S / areaM2;
          } else if (iO2.includes("area") && iO2.includes("speed")) {
            var areaM2 = parseFloat(document.getElementById("areaM2").value);
            var speedMS = parseFloat(document.getElementById("speedMS").value);
            flowM3S = speedMS * areaM2;
            document.getElementById("flowM3S").value = flowM3S;
            document.getElementById("flowM3H").value = speedMS * areaM2 * 3600;
          } else if (iO2.includes("flow") && iO2.includes("speed")) {
            var flowM3S = parseFloat(document.getElementById("flowM3S").value);
            var speedMS = parseFloat(document.getElementById("speedMS").value);
            areaM2 = flowM3S / speedMS;
            document.getElementById("areaM2").value = areaM2;
            document.getElementById("areaDiameterMM").value =
              (areaM2 / Math.PI) ** 0.5 * 2 * 1000;
          }
        }
      }

      // Array that keeps track of the order of parameter inputs
      // possible values: "area", "flow", "speed"
      inputOrder = new Array(0);

      function updateInputOrder(inputID) {
        if (inputID.startsWith("area")) {
          updateInputOrderArray("area");
        } else if (inputID.startsWith("flow")) {
          updateInputOrderArray("flow");
        } else if (inputID.startsWith("speed")) {
          updateInputOrderArray("speed");
        } else {
        }

        function updateInputOrderArray(inputType) {
          const index = inputOrder.indexOf(inputType);
          if (index > -1) {
            // Remove the element from its current position
            inputOrder.splice(index, 1);
            // Add it to the front of the array
            inputOrder.unshift(inputType);
          } else {
            // Add to front of the array
            inputOrder.unshift(inputType);
          }
        }

        console.log(inputOrder);
      }
    </script>
  </body>
</html>
