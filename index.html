<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Air Flow Calculator</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }

      label {
        display: block;
        margin-bottom: 5px;
      }

      input {
        width: 50%;
        padding: 8px;
        margin-bottom: 10px;
        box-sizing: border-box;
      }

      .unit-label {
        display: inline-block;
        width: 25%;
        margin-left: 5px;
      }

      button {
        padding: 10px;
        background-color: #4caf50;
        color: white;
        border: none;
        cursor: pointer;
      }

      .unconfirmed {
        border: 2px solid red;
      }
    </style>
  </head>
  <body>
    <h1>Air Flow Calculator</h1>

    <label for="flowM3S">Air Flow:</label>
    <div>
      <input
        type="number"
        id="flowM3S"
        placeholder="Enter air flow (m³/s)"
        oninput="changedInput(event)"
      />
      <span class="unit-label">m³/s</span>
      <input
        type="number"
        id="flowM3H"
        placeholder="Enter air flow (m³/h)"
        oninput="changedInput(event)"
      />
      <span class="unit-label">m³/h</span>
    </div>

    <label for="areaM2">Querschnittsfläche:</label>
    <div>
      <input
        type="number"
        id="areaM2"
        placeholder="Enter area section (m²)"
        oninput="changedInput(event)"
      />
      <span class="unit-label">m²</span>
      <input
        type="number"
        id="areaDiameterMM"
        placeholder="Enter diamter (mm)"
        oninput="changedInput(event)"
      />
      <span class="unit-label">mm</span>
    </div>

    <label for="speedMS">Air Speed (m/s):</label>
    <div>
      <input
        type="number"
        id="speedMS"
        placeholder="Enter air speed"
        oninput="changedInput(event)"
      />
      <span class="unit-label">m/s</span>
    </div>

    <script>
      function changedInput(event) {
        console.log("changedInput");
        console.log(event.currentTarget.id);
        convertUnits(event.currentTarget.id);
        updateInputOrder(event.currentTarget.id);
        calculateVolumeFlow();
      }

      function convertUnits(idEntered) {
        // Convert air flow to m³/s if entered in m³/h
        if ("flowM3H" == idEntered) {
          // Get input value
          var flowM3H = parseFloat(document.getElementById("flowM3H").value);
          if (!isNaN(flowM3H)) {
            document.getElementById("flowM3S").value = (flowM3H / 3600).toFixed(
              4
            ); // 1 m³/s = 3600 m³/h
          }
        }

        // Convert air flow to m³/h if entered in m³/s
        if ("flowM3S" == idEntered) {
          // Get input value
          var flowM3S = parseFloat(document.getElementById("flowM3S").value);
          if (!isNaN(flowM3S)) {
            document.getElementById("flowM3H").value = (flowM3S * 3600).toFixed(
              4
            ); // 1 m³/s = 3600 m³/h
          }
        }

        // Cross section in m²
        if ("areaM2" == idEntered) {
          // Get input value
          var areaM2 = parseFloat(document.getElementById("areaM2").value);
          if (!isNaN(areaM2)) {
            document.getElementById("areaDiameterMM").value = (
              (areaM2 / Math.PI) ** 0.5 *
              2 *
              1000
            ).toFixed(4);
          }
        }

        // Diameter in mm
        if ("areaDiameterMM" == idEntered) {
          // Get input value
          var areaDiameterMM = parseFloat(
            document.getElementById("areaDiameterMM").value
          );
          if (!isNaN(areaDiameterMM)) {
            document.getElementById("areaM2").value = (
              (areaDiameterMM / 1000 / 2) ** 2 *
              Math.PI
            ).toFixed(4);
          }
        }
      }

      function calculateVolumeFlow() {
        if (inputOrder.length >= 2) {
          iO2 = inputOrder.slice(0, 2);
          console.log(iO2);
          if (iO2.includes("area") && iO2.includes("flow")) {
            var areaM2 = parseFloat(document.getElementById("areaM2").value);
            var flowM3S = parseFloat(document.getElementById("flowM3S").value);
            document.getElementById("speedMS").value = flowM3S / areaM2;
          } else if (iO2.includes("area") && iO2.includes("speed")) {
            var areaM2 = parseFloat(document.getElementById("areaM2").value);
            var speedMS = parseFloat(document.getElementById("speedMS").value);
            flowM3S = speedMS * areaM2;
            document.getElementById("flowM3S").value = flowM3S;
            document.getElementById("flowM3H").value = speedMS * areaM2 * 3600;
          } else if (iO2.includes("flow") && iO2.includes("speed")) {
            var flowM3S = parseFloat(document.getElementById("flowM3S").value);
            var speedMS = parseFloat(document.getElementById("speedMS").value);
            areaM2 = flowM3S / speedMS;
            document.getElementById("areaM2").value = areaM2;
            document.getElementById("areaDiameterMM").value =
              (areaM2 / Math.PI) ** 0.5 * 2 * 1000;
          }
        }
      }

      // Array that keeps track of the order of parameter inputs
      // possible values: "area", "flow", "speed"
      inputOrder = new Array(0);

      function updateInputOrder(inputID) {
        if (inputID.startsWith("area")) {
          updateInputOrderArray("area");
        } else if (inputID.startsWith("flow")) {
          updateInputOrderArray("flow");
        } else if (inputID.startsWith("speed")) {
          updateInputOrderArray("speed");
        } else {
        }

        function updateInputOrderArray(inputType) {
          const index = inputOrder.indexOf(inputType);
          if (index > -1) {
            // Remove the element from its current position
            inputOrder.splice(index, 1);
            // Add it to the front of the array
            inputOrder.unshift(inputType);
          } else {
            // Add to front of the array
            inputOrder.unshift(inputType);
          }
        }

        console.log(inputOrder);
      }
    </script>
  </body>
</html>
